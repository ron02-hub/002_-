# アンケート実施のためのセットアップ手順

## 📋 前提条件

- Node.js 18以上がインストールされていること
- npm または yarn が利用可能であること
- PostgreSQLデータベース（Supabase推奨）へのアクセス

## 🚀 セットアップ手順

### ステップ1: 依存関係のインストール

```bash
cd src
npm install
```

### ステップ2: データベースの準備

#### オプションA: Supabaseを使用する場合（推奨）

1. [Supabase](https://supabase.com)でアカウントを作成
2. 新しいプロジェクトを作成
3. プロジェクト設定から以下を取得：
   - Database URL（接続文字列）
   - Project URL
   - Anon Key（オプション）

#### オプションB: ローカルPostgreSQLを使用する場合

```bash
# PostgreSQLがインストールされていることを確認
psql --version

# データベースを作成
createdb ev_survey
```

### ステップ3: 環境変数の設定

`src/.env.local`ファイルを作成し、以下の内容を設定：

```env
# データベース接続（Supabaseの場合）
DATABASE_URL="postgresql://postgres:[PASSWORD]@db.[PROJECT_ID].supabase.co:5432/postgres"

# またはローカルPostgreSQLの場合
# DATABASE_URL="postgresql://postgres:password@localhost:5432/ev_survey"

# Next.js設定
NEXT_PUBLIC_APP_URL="http://localhost:3000"
```

**重要**: `.env.local`ファイルは`.gitignore`に含まれているため、Gitにはコミットされません。

### ステップ4: データベースマイグレーション

```bash
cd src

# Prismaクライアントを生成
npm run db:generate

# データベースにマイグレーションを適用
npm run db:migrate

# シードデータを投入（音声サンプルのメタデータを登録）
npm run db:seed
```

### ステップ5: 音声ファイルの準備

アンケートで使用する音声ファイルを準備します。

1. `src/public/audio/samples/`ディレクトリに以下の音声ファイルを配置：
   - `sample-a.mp3` - EV走行音サンプル A（低音が響く重厚感のある走行音）
   - `sample-b.mp3` - EV走行音サンプル B（高音が目立つ軽快な走行音）
   - `sample-c.mp3` - EV走行音サンプル C（バランスの取れた中性的な走行音）
   - `sample-d.mp3` - EV走行音サンプル D（静粛性を重視した控えめな走行音）
   - `sample-e.mp3` - EV走行音サンプル E（未来感のある電子音的な走行音）

2. 音声ファイルの推奨仕様：
   - フォーマット: MP3（128-192kbps）またはWAV
   - 長さ: 約10秒
   - サンプリングレート: 44.1kHz以上

**注意**: 音声ファイルが存在しない場合、アンケート中に音声再生エラーが発生する可能性があります。

### ステップ6: 開発サーバーの起動

```bash
cd src
npm run dev
```

ブラウザで [http://localhost:3000](http://localhost:3000) にアクセスして、アンケートアプリケーションが正常に起動することを確認してください。

## ✅ 動作確認

### 1. ランディングページの確認

- [http://localhost:3000](http://localhost:3000) にアクセス
- 「アンケートを開始する」ボタンが表示されることを確認

### 2. データベース接続の確認

```bash
cd src
npm run db:studio
```

Prisma Studioが起動し、データベースの内容を確認できます。

### 3. 音声ファイルの確認

- `src/public/audio/samples/`ディレクトリに5つの音声ファイルが存在することを確認
- ブラウザで直接アクセスして再生できることを確認：
  - http://localhost:3000/audio/samples/sample-a.mp3

## 🔧 トラブルシューティング

### データベース接続エラー

**エラー**: `Can't reach database server`

**解決方法**:
1. `DATABASE_URL`が正しいか確認
2. Supabaseの場合、接続設定で「Allow connections from anywhere」が有効か確認
3. ファイアウォール設定を確認

### マイグレーションエラー

**エラー**: `Migration failed`

**解決方法**:
```bash
# マイグレーションをリセット（開発環境のみ、データが削除されます）
npx prisma migrate reset

# 再度マイグレーションを実行
npm run db:migrate
npm run db:seed
```

### 音声ファイルが見つからない

**エラー**: 音声再生時に404エラー

**解決方法**:
1. `src/public/audio/samples/`ディレクトリに音声ファイルが存在するか確認
2. ファイル名がシードデータと一致しているか確認（sample-a.mp3, sample-b.mp3など）
3. ファイルのパーミッションを確認

### 依存関係のエラー

**エラー**: `Module not found`

**解決方法**:
```bash
# node_modulesを削除して再インストール
rm -rf node_modules package-lock.json
npm install
```

## 📝 次のステップ

セットアップが完了したら、以下の手順でアンケートを実施できます：

1. **テスト実施**: 自分でアンケートを実施して動作を確認
2. **音声ファイルの準備**: 実際のEV走行音サンプルを用意
3. **本番環境へのデプロイ**: Vercel、Netlifyなどにデプロイ（オプション）

## 🎯 アンケート実施時の注意事項

- **音声品質**: 高品質な音声ファイルを使用することで、より正確な評価が得られます
- **ヘッドホン推奨**: 回答者にはヘッドホンの使用を推奨してください
- **環境**: 静かな環境での実施を推奨します
- **所要時間**: アンケート完了まで約45分かかります

## 📞 サポート

問題が発生した場合は、以下を確認してください：

1. ログファイルの確認
2. ブラウザのコンソールエラーの確認
3. データベース接続の確認

