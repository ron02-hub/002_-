# データベース設定ガイド

## 📋 現在の状態

- ✅ Prismaクライアント: 生成済み
- ❓ データベース接続: 設定が必要

## 🔧 データベース接続の設定方法

### オプション1: Supabaseを使用（推奨・無料プランあり）

1. **Supabaseアカウントの作成**
   - [https://supabase.com](https://supabase.com) にアクセス
   - アカウントを作成（GitHubアカウントでログイン可能）

2. **プロジェクトの作成**
   - ダッシュボードで「New Project」をクリック
   - プロジェクト名を入力（例: `ev-survey`）
   - データベースパスワードを設定（重要：後で使用します）
   - リージョンを選択（`Tokyo`推奨）
   - 「Create new project」をクリック

3. **接続情報の取得**
   - プロジェクトが作成されたら、「Settings」→「Database」に移動
   - 「Connection string」セクションで「URI」を選択
   - 表示された接続文字列をコピー
   - 形式: `postgresql://postgres.[PROJECT_REF]:[PASSWORD]@aws-0-[REGION].pooler.supabase.com:6543/postgres`

4. **環境変数の設定**
   - `src/.env.local`ファイルを開く
   - `DATABASE_URL`のコメントを外し、取得した接続文字列を設定：
   ```env
   DATABASE_URL="postgresql://postgres.[PROJECT_REF]:[PASSWORD]@aws-0-[REGION].pooler.supabase.com:6543/postgres"
   ```
   - `[PASSWORD]`は、プロジェクト作成時に設定したパスワードに置き換えてください

### オプション2: ローカルPostgreSQLを使用

1. **PostgreSQLのインストール**
   ```bash
   # macOS (Homebrew)
   brew install postgresql@14
   brew services start postgresql@14
   
   # または PostgreSQL公式サイトからインストール
   ```

2. **データベースの作成**
   ```bash
   createdb ev_survey
   ```

3. **環境変数の設定**
   - `src/.env.local`ファイルを開く
   - `DATABASE_URL`のコメントを外し、ローカル接続文字列を設定：
   ```env
   DATABASE_URL="postgresql://postgres:password@localhost:5432/ev_survey"
   ```
   - `password`は、PostgreSQLのパスワードに置き換えてください

## 🚀 マイグレーションの実行

データベース接続が設定されたら、以下のコマンドを実行：

```bash
cd src

# データベースにマイグレーションを適用
npx prisma migrate dev --name init

# シードデータを投入
npm run db:seed
```

## ✅ 接続確認

```bash
cd src

# Prisma Studioでデータベースを確認
npm run db:studio
```

Prisma Studioが起動し、ブラウザでデータベースの内容を確認できます。

## ⚠️ トラブルシューティング

### 接続エラーが発生する場合

1. **Supabaseの場合**
   - 接続文字列が正しいか確認
   - パスワードが正しいか確認
   - Supabaseのダッシュボードで「Settings」→「Database」→「Connection pooling」が有効か確認

2. **ローカルPostgreSQLの場合**
   - PostgreSQLが起動しているか確認: `brew services list`
   - データベースが存在するか確認: `psql -l`
   - パスワードが正しいか確認

### マイグレーションエラーが発生する場合

```bash
# マイグレーションをリセット（開発環境のみ、データが削除されます）
npx prisma migrate reset

# 再度マイグレーションを実行
npx prisma migrate dev --name init
```

## 📝 次のステップ

データベース接続が完了したら：

1. マイグレーションを実行
2. シードデータを投入
3. 音声ファイルを準備
4. 開発サーバーを起動

