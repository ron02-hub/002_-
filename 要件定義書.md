# EV走行音アンケートアプリケーション 要件定義書

**プロジェクト名**: EV走行音アンケートアプリケーション  
**バージョン**: 1.9.0  
**作成日**: 2026-01-01  
**最終更新日**: 2026-01-05

---

## 1. プロジェクト概要

### 1.1 目的
電気自動車（EV）の走行音に対するユーザー印象を多面的に解析し、走行音が「ブランド価値」および「購買意欲」に与える影響を定量化する。得られた知見を元に、車両の市場価値を向上させるための戦略的サウンドデザインの指針を策定する。

### 1.2 背景
- EVの静粛性を「無」から「新たな付加価値」へ転換するサウンドデザインの重要性
- 走行音がユーザーの「品質感」「信頼感」「先進性」の知覚に与える影響の解明
- 具体的な車両コンテキスト（N-Box, 200万円等）下での実利的価値の測定
- 統計学、心理学、音響工学を統合した、再現性の高い価値評価スキームの構築

### 1.3 対象ユーザー
- **回答者**: 日本国内の成人（20〜70歳）
- **分析者**: マーケティング担当者、音響エンジニア、製品企画担当者

### 1.4 スコープ
- **含まれるもの**:
  - Webベースのアンケート実施システム
  - 音声・動画再生機能
  - 評価グリッド法による深層価値探索
  - デプスインタビュー型質問インターフェース
  - データ分析・可視化機能
  - 管理者ダッシュボード

- **含まれないもの**:
  - 音声ファイルの作成・編集機能
  - 外部システムとの連携（将来的に拡張可能）
  - モバイルアプリ（Webアプリで対応）

---

## 2. 機能要件

### 2.1 コア機能

#### FR-001: 音声・動画再生機能
- **説明**: 複数のEV走行音サンプル（音声・動画）をWeb上で再生できる
- **詳細**:
  - 高品質オーディオ・動画再生（MP3/WAV/MP4対応）
  - 音量調整機能
  - 再生位置表示・シーク機能
  - 動画表示機能（動画ファイルの場合）
  - ストリーミング再生対応（Rangeリクエスト）
  - モバイル・デスクトップ両対応
- **優先度**: 必須
- **受入基準**:
  - 指定ディレクトリの動画ファイル（`/Users/ry/Documents/06_Cursor/999_data/Movie`）を再生できる
  - 音声テスト用ディレクトリ（`/Users/ry/Documents/06_Cursor/999_data/Sound_data/999_AudioTest`）の音声ファイルを再生できる
  - 音声・動画の両形式に対応（自動判定）
  - クロスブラウザ対応（Chrome, Safari, Firefox, Edge）
- **実装状況**: ✅ 完了（MediaPlayerコンポーネント、useMediaPlayerフック）

#### FR-002: デプスインタビュー型質問インターフェース
- **説明**: 対話形式で深層心理を引き出す質問システム
- **詳細**:
  - チャット風UIでの質問表示
  - 回答に応じた動的な追加質問生成
  - 「なぜそう思いましたか？」等の掘り下げ質問
  - 自然言語による自由回答の収集
  - タイピングアニメーションによる自然な対話体験
- **優先度**: 必須
- **受入基準**:
  - 回答者の回答内容に基づいて適切な追加質問が生成される
  - 最低3ラウンドの深掘り質問が可能

#### FR-003: 評価グリッド法（Repertory Grid）機能
- **説明**: ユーザーの構成概念（コンストラクト）を抽出する
- **詳細**:
  - 全音声サンプルから「最も印象が良い音」と「最も印象が悪い音」を選択
  - 選択された音に対する印象の理由（具体的特徴）を抽出
  - 抽出されたコンストラクトの階層化
  - ラダリング（上位・下位概念の探索）
- **優先度**: 必須
- **受入基準**:
  - 印象の対比による評価軸抽出がスムーズに行えるUI
  - コンストラクトの階層構造が保存される

#### FR-004: 定量評価機能
- **説明**: 音の印象を数値化する評価尺度
- **詳細**:
  - SD法（Semantic Differential）による7段階評価（9軸：自然さ/人工的を追加）
  - リッカート尺度による購買意欲評価（7段階、車両スペック等の前提条件を提示）
  - 自由記述入力
- **優先度**: 必須
- **受入基準**:
  - 9つの評価軸すべてが評価可能
  - 購買意欲評価時に前提条件（Honda N-Box, 200万等）が正しく表示される
  - 評価結果がデータベースに保存される

#### FR-005: A/Bテスト・ランダム化比較機能
- **説明**: 統計的に有効な比較評価を実現
- **詳細**:
  - 回答者のランダムグループ割り当て
  - 音声サンプルの提示順序ランダム化
  - 層化ランダム割り当て（年齢・性別考慮）
  - 対照群との比較分析
- **優先度**: 必須
- **受入基準**:
  - 回答者が均等にグループに割り当てられる
  - 提示順序がランダム化される

### 2.2 分析・可視化機能

#### FR-006: 価値構造ツリー可視化
- **説明**: ユーザー価値を階層的に表示
- **詳細**:
  - 評価グリッド法の結果をツリー構造で表示
  - 上位価値→中位価値→下位価値の階層表示
  - インタラクティブな展開・折りたたみ
  - D3.jsによる可視化
- **優先度**: 必須
- **受入基準**:
  - 階層構造が視覚的に分かりやすく表示される
  - ノードの展開・折りたたみが可能

#### FR-007: 自然言語処理分析
- **説明**: 自由回答テキストの分析
- **詳細**:
  - 形態素解析による頻出キーワード抽出（MeCab対応）
  - 感情分析（ポジティブ/ネガティブ、BERT対応）
  - トピックモデリング
  - 共起ネットワーク分析
- **優先度**: 高
- **受入基準**:
  - 日本語テキストの形態素解析が可能
  - 感情分析結果が可視化される

#### FR-008: 統計解析ダッシュボード
- **説明**: 収集データの統計分析と可視化
- **詳細**:
  - 回答の分布・クロス集計
  - SD法スコアのレーダーチャート表示
  - 購買意欲分布のヒストグラム表示
  - 相関分析
  - 因子分析
  - クラスター分析（回答者セグメンテーション）
- **優先度**: 高
- **受入基準**:
  - 主要な統計指標が可視化される
  - データのエクスポートが可能

### 2.3 管理機能

#### FR-009: 管理者ダッシュボード
- **説明**: アンケートの管理と進捗確認
- **詳細**:
  - 回答状況のリアルタイム確認
  - 音声サンプルの追加・編集（将来的に拡張）
  - 質問項目の設定（将来的に拡張）
  - データエクスポート機能
- **優先度**: 高
- **受入基準**:
  - 回答数、完了率が表示される
  - CSV形式でのデータエクスポートが可能

#### FR-010: 中断・再開機能
- **説明**: アンケート途中で中断し、後で再開できる
- **詳細**:
  - セッション情報の保存
  - 再開時の進捗復元
  - ブラウザのローカルストレージ活用（Zustand persist）
- **優先度**: 中
- **受入基準**:
  - 中断後、同じブラウザで再開できる
  - 進捗が正しく復元される
- **実装状況**: ✅ 完了（Zustand persist middleware使用）

#### FR-011: テストモード機能
- **説明**: 開発・テスト用にクエリパラメータでデータを設定できる
- **詳細**:
  - クエリパラメータ（`?test=true`）でテストモードを有効化
  - 同意・属性情報をクエリパラメータから読み込み
  - ヘッドホンチェックをスキップ可能
- **優先度**: 低（開発用）
- **受入基準**:
  - テストモードでアンケートを開始できる
  - 設定したデータが正しく反映される
- **実装状況**: ✅ 完了（evaluation/page.tsxに実装）

---

## 3. 非機能要件

### 3.1 パフォーマンス

#### NFR-001: 応答時間
- **説明**: ユーザー操作に対する応答時間
- **要件**:
  - ページ遷移: 1秒以内
  - API応答: 500ms以内
  - 音声・動画読み込み: 3秒以内（ネットワーク状況による）

#### NFR-002: 同時接続数
- **説明**: 同時にアンケートに回答できるユーザー数
- **要件**: 最低100ユーザー同時接続に対応

#### NFR-003: データ処理
- **説明**: 大量データの処理性能
- **要件**: 1000件の回答データを5秒以内に処理・可視化

### 3.2 可用性

#### NFR-004: 稼働率
- **説明**: システムの稼働率
- **要件**: 99%以上（月間ダウンタイム: 7.2時間以内）

#### NFR-005: 障害復旧
- **説明**: 障害発生時の復旧時間
- **要件**: 重大な障害でも24時間以内に復旧

### 3.3 セキュリティ

#### NFR-006: データ保護
- **説明**: 個人情報・回答データの保護
- **要件**:
  - HTTPS通信の必須化
  - 個人情報の暗号化保存
  - アクセスログの記録

#### NFR-007: 認証・認可
- **説明**: 管理者機能へのアクセス制御
- **要件**:
  - 管理者認証の実装（将来的に拡張）
  - セッション管理

### 3.4 ユーザビリティ

#### NFR-008: 操作性
- **説明**: ユーザーインターフェースの使いやすさ
- **要件**:
  - 直感的な操作フロー
  - 明確な進捗表示
  - エラーメッセージの分かりやすさ

#### NFR-009: アクセシビリティ
- **説明**: 様々なユーザーが利用できる設計
- **要件**:
  - WCAG 2.1 AA準拠
  - キーボード操作対応
  - スクリーンリーダー対応

#### NFR-010: レスポンシブデザイン
- **説明**: 様々なデバイスでの利用
- **要件**:
  - デスクトップ（1920x1080以上）
  - タブレット（768x1024以上）
  - スマートフォン（375x667以上）

### 3.5 保守性

#### NFR-011: コード品質
- **説明**: 保守しやすいコード
- **要件**:
  - TypeScriptによる型安全性
  - ESLint、Prettierによるコード品質管理
  - テストカバレッジ: 最低60%

#### NFR-012: ドキュメント
- **説明**: 適切なドキュメント整備
- **要件**:
  - コードコメント
  - API仕様書
  - 運用マニュアル

---

## 4. 制約条件

### 4.1 技術的制約
- **ブラウザ対応**: モダンブラウザ（Chrome, Safari, Firefox, Edgeの最新2バージョン）
- **音声・動画形式**: MP3, WAV, MP4（H.264）
- **データベース**: PostgreSQL（Supabase推奨）

### 4.2 ビジネス制約
- **開発期間**: 8週間（Phase 1-4）
- **予算**: オープンソース技術を中心に使用
- **リソース**: 1名の開発者を想定

### 4.3 法的制約
- **個人情報保護**: 個人情報保護法に準拠
- **データ取り扱い**: 回答データの適切な管理

---

## 5. データ要件

### 5.1 データモデル
- **回答者情報**: 年齢、性別、地域、運転歴、EV所有経験、音への感度
- **評価データ**: SD法スコア、購買意欲、自由記述
- **コンストラクト**: トライアド比較結果、類似・相違理由、ラダリング結果
- **インタビュー**: 質問履歴、回答履歴

### 5.2 データ保存
- **保存期間**: プロジェクト期間中
- **バックアップ**: 日次バックアップ
- **エクスポート**: CSV形式でのエクスポート機能

---

## 6. インターフェース要件

### 6.1 外部インターフェース
- **音声・動画ファイル**: ローカルファイルシステムまたはクラウドストレージ
- **データベース**: PostgreSQL（Supabase）

### 6.2 ユーザーインターフェース
- **回答者画面**: シンプルで直感的なUI
- **管理者画面**: データ可視化を重視したダッシュボード

---

## 7. 受入基準

### 7.1 機能受入基準
- すべての必須機能（FR-001〜FR-005）が正常に動作する
- 分析機能（FR-006〜FR-008）が正常に動作する
- 管理者機能（FR-009）が正常に動作する

### 7.2 非機能受入基準
- パフォーマンス要件（NFR-001〜NFR-003）を満たす
- セキュリティ要件（NFR-006〜NFR-007）を満たす
- ユーザビリティ要件（NFR-008〜NFR-010）を満たす

### 7.3 テスト受入基準
- ユニットテスト: 最低60%のカバレッジ
- 統合テスト: 主要な機能フローが正常に動作
- ユーザー受入テスト: 実際のユーザーによるテスト実施

---

## 8. 変更履歴

| 日付 | バージョン | 変更内容 | 変更者 |
|------|-----------|----------|--------|
| 2026-01-01 | 1.0.0 | 初版作成 | - |
| 2026-01-04 | 1.1.0 | 評価軸の追加（自然さ）、購買意欲評価の前提条件追加、評価グリッド法の手法変更（トライアド→最良・最悪比較）を反映 | - |
| 2026-01-04 | 1.6.0 | 音声テスト画面の改善（選択肢形式、正解チェック機能）、本番環境準備完了 | - |
| 2026-01-05 | 1.7.0 | E2Eテスト修正（テストモード実装、クエリパラメータ継承、テストスクリプト改善） | - |
| 2026-01-05 | 1.8.0 | ユーザビリティテスト実施・分析（仮想ペルソナ200名、Excel出力、分析レポート作成） | - |
| 2026-01-05 | 1.9.0 | マーケティング分析レポート生成（全分析手法、Excel出力、小学生にもわかる説明） | - |
| 2026-01-05 | 2.0.0 | 評価グリッド法（価値ツリー）の集計・分析結果をレポートに追加、設計書の整合性確認 | - |

---

## 9. 承認

| 役割 | 名前 | 承認日 | 署名 |
|------|------|--------|------|
| プロジェクトマネージャー | - | - | - |
| 技術リーダー | - | - | - |

