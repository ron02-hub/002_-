# テストラン手順

## 🚀 クイックテスト（UI確認のみ）

データベース接続なしでも、ランディングページなどのUIは確認できます。

### ステップ1: 開発サーバーを起動

```bash
cd src
npm run dev
```

ブラウザで [http://localhost:3000](http://localhost:3000) にアクセス。

**確認できること**:
- ✅ ランディングページの表示
- ✅ 「アンケートを開始する」ボタンの表示
- ✅ 基本的なUI/UX

**制限事項**:
- ❌ アンケートを進めるとデータベース接続エラーが発生します
- ❌ 回答の保存はできません

## 🎯 完全なテストラン（推奨）

アンケート全体をテストするには、データベース接続が必要です。

### ステップ1: Supabaseでデータベースをセットアップ（約5分）

1. **Supabaseアカウント作成**
   - https://supabase.com にアクセス
   - 「Start your project」をクリック
   - GitHubアカウントでログイン（推奨）

2. **プロジェクト作成**
   - 「New Project」をクリック
   - プロジェクト名: `ev-survey-test`（任意）
   - データベースパスワード: 任意のパスワードを設定（**重要：後で使用します**）
   - リージョン: `Tokyo`（または最寄り）
   - 「Create new project」をクリック
   - プロジェクト作成完了まで2-3分待機

3. **接続情報を取得**
   - プロジェクトが作成されたら、「Settings」→「Database」に移動
   - 「Connection string」セクションで「URI」を選択
   - 表示された接続文字列をコピー
   - 例: `postgresql://postgres.xxxxx:[YOUR-PASSWORD]@aws-0-ap-northeast-1.pooler.supabase.com:6543/postgres`

### ステップ2: 環境変数を設定（約1分）

```bash
cd src

# .env.localファイルを編集
# DATABASE_URLのコメントを外し、取得した接続文字列を設定
```

`.env.local`ファイルを開いて、以下のように設定：

```env
# データベース接続（Supabaseから取得した接続文字列を貼り付け）
DATABASE_URL="postgresql://postgres.xxxxx:[YOUR-PASSWORD]@aws-0-ap-northeast-1.pooler.supabase.com:6543/postgres"

# Next.js設定
NEXT_PUBLIC_APP_URL="http://localhost:3000"
NODE_ENV="development"
```

**重要**: `[YOUR-PASSWORD]`は、プロジェクト作成時に設定したパスワードに置き換えてください。

### ステップ3: データベースマイグレーション（約2分）

```bash
cd src

# マイグレーションを実行
npx prisma migrate dev --name init

# シードデータを投入（音声サンプルのメタデータを登録）
npm run db:seed
```

### ステップ4: 音声ファイルの準備（テスト用）

**オプションA: テスト用のダミーファイルを作成**

```bash
cd src/public/audio/samples

# macOSの場合、短いテスト音声を作成（10秒の無音）
# 注意: これは実際のアンケートには使用しないでください
```

**オプションB: 実際の音声ファイルを配置**

5つの音声ファイル（sample-a.mp3 ～ sample-e.mp3）を配置。

**オプションC: 音声ファイルなしでテスト**

音声ファイルがなくても、アプリケーションは起動しますが、音声再生時にエラーが表示されます。

### ステップ5: 開発サーバーを起動

```bash
cd src
npm run dev
```

ブラウザで [http://localhost:3000](http://localhost:3000) にアクセス。

## ✅ テスト確認項目

1. **ランディングページ**
   - [ ] ページが正常に表示される
   - [ ] 「アンケートを開始する」ボタンが動作する

2. **同意フォーム**
   - [ ] 同意フォームが表示される
   - [ ] フォーム送信が動作する

3. **属性入力**
   - [ ] 属性入力フォームが表示される
   - [ ] フォーム送信が動作する

4. **音声チェック**
   - [ ] 音声チェック画面が表示される
   - [ ] 音声ファイルが再生できる（ファイルがある場合）

5. **音声評価**
   - [ ] 音声評価画面が表示される
   - [ ] SD法評価が動作する

## ⚠️ トラブルシューティング

### データベース接続エラー

**エラー**: `Can't reach database server`

**解決方法**:
1. `.env.local`の`DATABASE_URL`が正しいか確認
2. パスワードが正しいか確認
3. Supabaseのプロジェクトが作成完了しているか確認

### マイグレーションエラー

**エラー**: `Migration failed`

**解決方法**:
```bash
# マイグレーションをリセット（開発環境のみ）
npx prisma migrate reset

# 再度マイグレーションを実行
npx prisma migrate dev --name init
npm run db:seed
```

### 音声ファイルが見つからない

**エラー**: 音声再生時に404エラー

**解決方法**:
- テスト用のダミーファイルを作成するか、実際の音声ファイルを配置してください
- 音声ファイルがなくても、アプリケーション自体は動作します

## 🎯 最短ルート（約10分）

1. Supabaseでプロジェクト作成（5分）
2. 接続情報を`.env.local`に設定（1分）
3. マイグレーション実行（2分）
4. 開発サーバー起動（1分）
5. ブラウザで確認（1分）

合計: 約10分で完全なテストランが可能です！

